{
  "rules": {
    "test": {
      ".read": "auth != null",
      ".write": "auth != null",

      "users": {
        "$uid": {
          ".read": "auth != null && auth.uid == $uid",
          ".write": "auth != null && auth.uid == $uid",
          ".validate": "newData.hasChildren(['uid', 'displayName', 'createdAt', 'lastSeenAt', 'showsAttended', 'preferences'])",
          "uid": {
            ".validate": "newData.val() == $uid"
          },
          "displayName": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 50"
          },
          "email": {
            ".validate": "newData.isString()"
          },
          "phone": {
            ".validate": "newData.isString()"
          }
        },
        ".indexOn": ["displayName"]
      },

      "members": {
        ".read": "root.child('test/admins').child(auth.uid).exists()",
        "$uid": {
          ".read": "auth != null && (auth.uid == $uid || root.child('test/admins').child(auth.uid).exists())",
          ".write": "auth != null && (auth.uid == $uid || root.child('test/admins').child(auth.uid).exists())",
          "roles": {
            ".validate": "root.child('test/admins').child(auth.uid).exists() || newData.val() == data.val()"
          },
          "role_assigned_by": {
            ".validate": "root.child('test/admins').child(auth.uid).exists() || newData.val() == data.val()"
          },
          "role_assigned_at": {
            ".validate": "root.child('test/admins').child(auth.uid).exists() || newData.val() == data.val()"
          }
        }
      },

      "shows": {
        ".read": "auth != null",
        "$showId": {
          "meta": {
            ".read": true,
            ".write": "root.child('admins').child(auth.uid).exists()"
          },
          "settings": {
            ".read": "root.child('admins').child(auth.uid).exists()",
            ".write": "root.child('admins').child(auth.uid).exists()"
          },
          "activities": {
            ".read": true,
            ".write": "root.child('admins').child(auth.uid).exists()"
          },
          "activities_private": {
            ".read": "root.child('admins').child(auth.uid).exists()",
            ".write": "root.child('admins').child(auth.uid).exists()"
          },
          "live": {
            ".read": true,
            ".write": "root.child('admins').child(auth.uid).exists()"
          },
          "attendees": {
            "$odience": {
              ".read": true,
              ".write": "auth != null && (auth.uid == $odience || root.child('admins').child(auth.uid).exists())",
              "flags": {
                ".read": "root.child('admins').child(auth.uid).exists()",
                ".write": "root.child('admins').child(auth.uid).exists()"
              }
            }
          },
          "responses": {
            "$activityId": {
              "$odience": {
                ".read": true,
                ".write": "auth != null && auth.uid == $odience",
                ".validate": "newData.hasChildren() && (!newData.hasChild('displayName') || newData.child('displayName').isString())"
              }
            }
          },
          "results": {
            ".read": true,
            ".write": "false"
          },
          "scores": {
            ".read": true,
            "$odience": {
              ".write": "auth != null && auth.uid == $odience"
            }
          },
          "leaderboard": {
            ".read": true,
            ".write": "false"
          },
          "offers": {
            ".read": true,
            ".write": "root.child('admins').child(auth.uid).exists()"
          },
          "offer_claims": {
            "$odience": {
              "$offerId": {
                ".read": "auth != null && auth.uid == $odience",
                ".write": "auth != null && auth.uid == $odience"
              }
            }
          }
        }
      },

      "seasons": {
        ".read": true,
        ".write": "root.child('admins').child(auth.uid).exists()"
      },

      "between_show_trivia": {
        "$triviaId": {
          ".read": true,
          ".write": "root.child('admins').child(auth.uid).exists()",
          "responses": {
            "$odience": {
              ".read": "auth != null && auth.uid == $odience",
              ".write": "auth != null && auth.uid == $odience"
            }
          }
        }
      },

      "trivia_library": {
        "settings": {
          ".read": "auth != null",
          ".write": "root.child('test/admins').child(auth.uid).exists()"
        },
        "categories": {
          ".read": "auth != null",
          ".write": "root.child('test/admins').child(auth.uid).exists()"
        },
        "questions": {
          ".read": "auth != null",
          ".write": "root.child('test/admins').child(auth.uid).exists()"
        },
        "activities": {
          ".read": "auth != null",
          ".write": "root.child('test/admins').child(auth.uid).exists()"
        },
        "schedule": {
          ".read": "auth != null",
          ".write": "root.child('test/admins').child(auth.uid).exists()"
        },
        "usage": {
          "$uid": {
            ".read": "auth != null && auth.uid == $uid",
            ".write": "auth != null && auth.uid == $uid"
          }
        }
      }
    },

    "users": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid",
        ".validate": "newData.hasChildren(['uid', 'displayName', 'createdAt', 'lastSeenAt', 'showsAttended', 'preferences'])",
        "uid": {
          ".validate": "newData.val() == $uid"
        },
        "displayName": {
          ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 50"
        },
        "email": {
          ".validate": "newData.isString()"
        },
        "phone": {
          ".validate": "newData.isString()"
        }
      },
      ".indexOn": ["displayName"]
    },

    "members": {
      ".read": "root.child('admins').child(auth.uid).exists()",
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).exists())",
        ".write": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).exists())",
        "roles": {
          ".validate": "root.child('admins').child(auth.uid).exists() || newData.val() == data.val()"
        },
        "role_assigned_by": {
          ".validate": "root.child('admins').child(auth.uid).exists() || newData.val() == data.val()"
        },
        "role_assigned_at": {
          ".validate": "root.child('admins').child(auth.uid).exists() || newData.val() == data.val()"
        }
      }
    },

    "shows": {
      ".read": "auth != null",
      "$showId": {
        "meta": {
          ".read": true,
          ".write": "root.child('admins').child(auth.uid).exists()"
        },
        "settings": {
          ".read": "root.child('admins').child(auth.uid).exists()",
          ".write": "root.child('admins').child(auth.uid).exists()"
        },
        "activities": {
          ".read": true,
          ".write": "root.child('admins').child(auth.uid).exists()"
        },
        "activities_private": {
          ".read": "root.child('admins').child(auth.uid).exists()",
          ".write": "root.child('admins').child(auth.uid).exists()"
        },
        "live": {
          ".read": true,
          ".write": "root.child('admins').child(auth.uid).exists()"
        },
        "attendees": {
          "$odience": {
            ".read": true,
            ".write": "auth != null && (auth.uid == $odience || root.child('admins').child(auth.uid).exists())",
            "flags": {
              ".read": "root.child('admins').child(auth.uid).exists()",
              ".write": "root.child('admins').child(auth.uid).exists()"
            }
          }
        },
        "responses": {
          "$activityId": {
            "$odience": {
              ".read": true,
              ".write": "auth != null && auth.uid == $odience",
              ".validate": "newData.hasChildren() && (!newData.hasChild('displayName') || newData.child('displayName').isString())"
            }
          }
        },
        "results": {
          ".read": true,
          ".write": "false"
        },
        "scores": {
          ".read": true,
          "$odience": {
            ".write": "auth != null && auth.uid == $odience"
          }
        },
        "leaderboard": {
          ".read": true,
          ".write": "false"
        },
        "offers": {
          ".read": true,
          ".write": "root.child('admins').child(auth.uid).exists()"
        },
        "offer_claims": {
          "$odience": {
            "$offerId": {
              ".read": "auth != null && auth.uid == $odience",
              ".write": "auth != null && auth.uid == $odience"
            }
          }
        },
        "team_scores": {
          ".read": "auth != null",
          ".write": false
        },
        "team_leaderboard": {
          ".read": "auth != null",
          ".write": false
        }
      }
    },

    "seasons": {
      ".read": true,
      ".write": "root.child('admins').child(auth.uid).exists()"
    },

    "between_show_trivia": {
      "$triviaId": {
        ".read": true,
        ".write": "root.child('admins').child(auth.uid).exists()",
        "responses": {
          "$odience": {
            ".read": "auth != null && auth.uid == $odience",
            ".write": "auth != null && auth.uid == $odience"
          }
        }
      }
    },

    "trivia_library": {
      "settings": {
        ".read": "auth != null",
        ".write": "root.child('admins').child(auth.uid).exists()"
      },
      "categories": {
        ".read": "auth != null",
        ".write": "root.child('admins').child(auth.uid).exists()"
      },
      "questions": {
        ".read": "auth != null",
        ".write": "root.child('admins').child(auth.uid).exists()"
      },
      "activities": {
        ".read": "auth != null",
        ".write": "root.child('admins').child(auth.uid).exists()"
      },
      "schedule": {
        ".read": "auth != null",
        ".write": "root.child('admins').child(auth.uid).exists()"
      },
      "usage": {
        "$uid": {
          ".read": "auth != null && auth.uid == $uid",
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    },

    "teams": {
      ".read": "auth != null",
      ".indexOn": ["name", "code"],
      "$teamId": {
        ".write": "auth != null && (!data.exists() || data.child('created_by').val() == auth.uid || root.child('admins').child(auth.uid).exists())",
        "members": {
          "$uid": {
            ".write": "auth != null && (auth.uid == $uid || data.parent().parent().child('created_by').val() == auth.uid || root.child('admins').child(auth.uid).exists())"
          }
        }
      }
    },

    "team_codes": {
      ".read": "auth != null",
      "$code": {
        ".write": "auth != null"
      }
    },

    "admins": {
      ".read": "root.child('admins').child(auth.uid).exists()",
      ".write": "auth != null"
    },

    "test": {
      "admins": {
        ".read": "root.child('test/admins').child(auth.uid).exists()",
        ".write": "auth != null"
      }
    }
  }
}
