{
  "rules": {
    // Test mode (development) - Allow all authenticated users
    "test": {
      ".read": "auth != null",
      ".write": "auth != null"
    },

    // Production rules
    "shows": {
      ".read": "auth != null",
      "$showId": {
        // Show metadata
        "meta": {
          ".read": true,
          ".write": "root.child('admins').child(auth.uid).val() === true"
        },

        // Activities (public and private)
        "activities": {
          ".read": true,
          ".write": "root.child('admins').child(auth.uid).val() === true"
        },
        "activities_private": {
          ".read": "root.child('admins').child(auth.uid).val() === true",
          ".write": "root.child('admins').child(auth.uid).val() === true"
        },

        // Live state
        "live": {
          ".read": true,
          ".write": "root.child('admins').child(auth.uid).val() === true"
        },

        // Leaderboard (admin only write)
        "leaderboard": {
          ".read": true,
          ".write": "root.child('admins').child(auth.uid).val() === true"
        },

        // Scores - users can write their own, everyone can read
        "scores": {
          ".read": true,
          "$uid": {
            ".write": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).val() === true)"
          }
        },

        // Attendees - users can write their own check-in
        "attendees": {
          ".read": true,
          "$uid": {
            ".write": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).val() === true)"
          }
        },

        // Show settings (admin only)
        "settings": {
          ".read": "root.child('admins').child(auth.uid).val() === true",
          ".write": "root.child('admins').child(auth.uid).val() === true"
        },

        // User responses (users can write their own)
        "responses": {
          "$activityId": {
            "$uid": {
              ".write": "auth != null && auth.uid == $uid"
            }
          }
        }
      }
    },

    // User profiles - users can read/write their own
    "users": {
      "$uid": {
        ".read": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).val() === true)",
        ".write": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).val() === true)"
      }
    },

    // Member profiles (for leaderboard)
    // - Admins can read ALL members (for marketing/CRM view)
    // - Individual users can read/write their own profile
    "members": {
      ".read": "root.child('admins').child(auth.uid).val() === true",
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && (auth.uid == $uid || root.child('admins').child(auth.uid).val() === true)"
      }
    },

    // Admin list - only readable/writable by existing admins
    "admins": {
      ".read": "root.child('admins').child(auth.uid).val() === true",
      ".write": "root.child('admins').child(auth.uid).val() === true"
    },

    // Leaderboards - public read, admin write
    "leaderboards": {
      ".read": "auth != null",
      ".write": "root.child('admins').child(auth.uid).val() === true"
    },

    // Controller heartbeat - authenticated users can write their own heartbeat
    "controller": {
      "heartbeat": {
        "$uid": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    },

    // Trivia library - public read for questions/schedule, users write their own usage
    "trivia_library": {
      "settings": {
        ".read": "auth != null",
        ".write": "root.child('admins').child(auth.uid).val() === true"
      },
      "categories": {
        ".read": "auth != null",
        ".write": "root.child('admins').child(auth.uid).val() === true"
      },
      "questions": {
        ".read": "auth != null",
        ".write": "root.child('admins').child(auth.uid).val() === true"
      },
      "activities": {
        ".read": "auth != null",
        ".write": "root.child('admins').child(auth.uid).val() === true"
      },
      "schedule": {
        ".read": "auth != null",
        ".write": "root.child('admins').child(auth.uid).val() === true"
      },
      "usage": {
        "$uid": {
          ".read": "auth != null && auth.uid == $uid",
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    }
  }
}
